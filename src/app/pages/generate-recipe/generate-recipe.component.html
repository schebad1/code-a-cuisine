<app-header-secondary></app-header-secondary>

<main>
  <section
    id="generate-recipe"
    class="generate"
    aria-labelledby="generate-title"
  >
    <header class="generate__header">
      <h1 id="generate-title" class="generate__title">Generate Recipe</h1>
      <span class="generate__subtitle">
        Got random stuff in your kitchen? Pop it in â€” we've got the perfect
        recipe waiting.
      </span>
    </header>
    <section class="generate__content">
      <article class="generate__form" aria-label="Ingredient input form">
        <div class="generate__input-group">
          <div class="generate__ingredient-section">
            <label for="ingredient-search" class="generate__label"
              >Ingredient</label
            >
            <div class="generate__ingredient-autocomplete">
              <div class="generate__ingredient-input">
                <input
                  type="text"
                  id="ingredient-search"
                  placeholder="Search ingredient..."
                  class="generate__search"
                  [(ngModel)]="ingredientName"
                  (ngModelChange)="onIngredientNameChange($event)"
                  name="ingredientName"
                />
              </div>
              <div
                class="generate__suggestion-dropdown"
                aria-label="Ingredient suggestions"
                *ngIf="filteredIngredientNames.length > 0"
              >
                <div
                  class="generate__suggestion-option"
                  *ngFor="let suggestion of filteredIngredientNames"
                  (click)="selectIngredientSuggestion(suggestion)"
                >
                  <span>{{ suggestion }}</span>
                </div>
              </div>
            </div>
          </div>
          <div class="generate__serving-section">
            <div class="generate__serving-labels">
              <span class="generate__label">Serving size</span>
            </div>
            <div class="generate__serving-inputs">
              <div class="generate__quantity-wrapper">
                <input
                  type="number"
                  id="quantity"
                  placeholder=""
                  min="0"
                  class="generate__quantity"
                  [(ngModel)]="ingredientQuantity"
                  name="quantity"
                />
              </div>
              <div class="generate__unit-wrapper">
                <div
                  class="generate__unit-display"
                  role="button"
                  tabindex="0"
                  (click)="toggleUnitDropdown()"
                  [attr.aria-expanded]="isUnitDropdownOpen"
                  aria-haspopup="listbox"
                >
                  <span class="generate__unit-text">{{ selectedUnit }}</span>

                  <img
                    [src]="
                      isUnitDropdownOpen
                        ? 'assets/generate-recipe/arrow_drop_down_up.svg'
                        : 'assets/generate-recipe/arrow_drop_down.svg'
                    "
                    alt="Toggle unit selection"
                    class="generate__unit-arrow"
                  />
                </div>

                <div
                  class="generate__unit-dropdown"
                  aria-label="Unit options"
                  *ngIf="isUnitDropdownOpen"
                >
                  <div
                    class="generate__unit-option"
                    (click)="selectUnit('piece')"
                  >
                    <span>piece</span>
                  </div>
                  <div class="generate__unit-option" (click)="selectUnit('ml')">
                    <span>ml</span>
                  </div>
                  <div
                    class="generate__unit-option"
                    (click)="selectUnit('gram')"
                  >
                    <span>gram</span>
                  </div>
                </div>
              </div>
              <div class="generate__add-wrapper">
                <div
                  class="generate__add"
                  role="button"
                  tabindex="0"
                  aria-label="Add ingredient"
                  (click)="addIngredient()"
                >
                  <img
                    src="assets/generate-recipe/add-icon-green.svg"
                    alt="Add"
                    class="generate__add-icon"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
      </article>
      <article class="generate__list" aria-label="Listed ingredients">
        <span class="generate__list-title">List of your Ingredients</span>
        <ul class="generate__ingredients">
          <li
            class="generate__ingredient"
            *ngFor="let ingredient of ingredients; let i = index"
          >
            <div class="generate__ingredient-row">
              <div class="generate__ingredient-info">
                <span class="generate__bullet" aria-hidden="true"></span>
                <span class="generate__ingredient-amount">
                  {{ ingredient.quantity }} {{ ingredient.unit }}
                </span>
                <span class="generate__ingredient-name">
                  {{ ingredient.name }}
                </span>
              </div>
              <div class="generate__ingredient-actions">
                <div
                  class="generate__ingredient-action generate__ingredient-edit"
                >
                  <img
                    src="assets/generate-recipe/edit-pencil.svg"
                    alt="Edit ingredient"
                  />
                </div>
                <div
                  class="generate__ingredient-action generate__ingredient-delete"
                  (click)="removeIngredient(i)"
                >
                  <img
                    src="assets/generate-recipe/trash-icon.svg"
                    alt="Delete ingredient"
                  />
                </div>
              </div>
            </div>
          </li>
        </ul>
      </article>
    </section>
    <p class="generate-recipe-cta">
      <a
      [routerLink]="canGoNext ? '/preferences' : null"
      class="btn"
      role="button"
      [class.btn--disabled]="!canGoNext"
      [attr.aria-disabled]="!canGoNext"
    >
      Next step
    </a>    
    </p>
  </section>
</main>
